"use strict";(self.webpackChunkdocumentation_v_2=self.webpackChunkdocumentation_v_2||[]).push([[8937],{47829:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>d,contentTitle:()=>r,default:()=>u,frontMatter:()=>a,metadata:()=>t,toc:()=>l});const t=JSON.parse('{"id":"Utilisateur/Billetterie/100 webhook","title":"Webhook","description":"Envoyer un POST pour chaque r\xe9servation ou adh\xe9sion valid\xe9e.","source":"@site/i18n/fr/docusaurus-plugin-content-docs/current/Utilisateur/Billetterie/100 webhook.md","sourceDirName":"Utilisateur/Billetterie","slug":"/Utilisateur/Billetterie/webhook","permalink":"/fr/docs/Utilisateur/Billetterie/webhook","draft":false,"unlisted":false,"editUrl":"https://github.com/TiBillet/documentation_v2/tree/main/docs/Utilisateur/Billetterie/100 webhook.md","tags":[],"version":"current","sidebarPosition":100,"frontMatter":{"sidebar_position":100,"slug":"webhook","title":"Webhook","description":"Envoyer un POST pour chaque r\xe9servation ou adh\xe9sion valid\xe9e.","keywords":["ticketing","billetterie","webhook","api"],"wiktags":["ticketing","billetterie","webhook","api"],"authors":"Jonas"},"sidebar":"tutorialSidebar","previous":{"title":"G\xe9rez vos ventes et paiements stripe","permalink":"/fr/docs/Utilisateur/Billetterie/stripe"},"next":{"title":"Integration","permalink":"/fr/docs/Utilisateur/Billetterie/iframe"}}');var o=i(74848),s=i(28453);const a={sidebar_position:100,slug:"webhook",title:"Webhook",description:"Envoyer un POST pour chaque r\xe9servation ou adh\xe9sion valid\xe9e.",keywords:["ticketing","billetterie","webhook","api"],wiktags:["ticketing","billetterie","webhook","api"],authors:"Jonas"},r=void 0,d={},l=[{value:"1) Webhook Reservation",id:"1-webhook-reservation",level:2},{value:"2) Webhook Adh\xe9sion",id:"2-webhook-adh\xe9sion",level:2},{value:"R\xe9capitulatif des principaux champs (Adh\xe9sion)",id:"r\xe9capitulatif-des-principaux-champs-adh\xe9sion",level:3}];function c(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.p,{children:"Il est possible de configurer des webhooks apr\xe8s chaque \xe9v\xe8nement r\xe9alis\xe9 sur la billetterie dans l'interface d'administration."}),"\n",(0,o.jsx)(n.p,{children:"Pour chaque webhook, la derni\xe8re r\xe9ponse HTTP est visible dans le champ \xab Last response \xbb."}),"\n",(0,o.jsx)(n.p,{children:"Types de webhooks pris en charge :"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Reservation (r\xe9servation confirm\xe9e)"}),"\n",(0,o.jsx)(n.li,{children:"Adh\xe9sion (abonnement/adh\xe9sion confirm\xe9e)"}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"1-webhook-reservation",children:"1) Webhook Reservation"}),"\n",(0,o.jsx)(n.p,{children:"Le webhook \xab Reservation \xbb se d\xe9clenche \xe0 chaque validation de r\xe9servation gratuite ou payante, au m\xeame moment que l'envoi des billets par e\u2011mail."}),"\n",(0,o.jsx)(n.p,{children:"Payload envoy\xe9 :"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-json",metastring:'title="Reservation (payload)"',children:'{\n  "object": "reservation",\n  "uuid": "<uuid de la r\xe9servation>",\n  "state": "<statut interne de la r\xe9servation>",\n  "datetime": "<date/heure de cr\xe9ation>"\n}\n'})}),"\n",(0,o.jsxs)(n.p,{children:["Vous pouvez ensuite r\xe9cup\xe9rer plus d'informations sur la r\xe9servation via l'API standard : ",(0,o.jsx)(n.a,{href:"/docs/api/reservations",children:"/docs/api/reservations"})]}),"\n",(0,o.jsx)(n.h2,{id:"2-webhook-adh\xe9sion",children:"2) Webhook Adh\xe9sion"}),"\n",(0,o.jsx)(n.p,{children:"Le webhook \xab Adh\xe9sion \xbb est envoy\xe9 lorsque l\u2019adh\xe9sion est pay\xe9e et donc consid\xe9r\xe9e comme valide."}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Concr\xe8tement, il est d\xe9clench\xe9 lorsque l'adh\xe9sion poss\xe8de une date d'\xe9ch\xe9ance (deadline) calcul\xe9e. Le champ ",(0,o.jsx)(n.code,{children:"is_valid"})," contenu dans le payload refl\xe8te la validit\xe9 au moment de l'envoi (true si ",(0,o.jsx)(n.code,{children:"deadline > maintenant"}),")."]}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"Cas particulier LaBoutik :"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Lors d'une adh\xe9sion cr\xe9\xe9e depuis LaBoutik, le webhook peut \xeatre envoy\xe9 deux fois :","\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["imm\xe9diatement apr\xe8s la cr\xe9ation, sans e\u2011mail ni nom/pr\xe9nom. Le champ ",(0,o.jsx)(n.code,{children:"email"})," contiendra alors une valeur de type ",(0,o.jsx)(n.code,{children:'"Anonymous <num_de_carte>"'})," (avec ",(0,o.jsx)(n.code,{children:"first_name"}),"/",(0,o.jsx)(n.code,{children:"last_name"})," vides)."]}),"\n",(0,o.jsx)(n.li,{children:"une seconde fois lorsque l'utilisateur scanne le QR code de sa carte et lie son e\u2011mail, nom et pr\xe9nom ; le webhook renvoie alors les informations personnelles mises \xe0 jour."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"Payload envoy\xe9 (d\xe9taill\xe9) :"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-json",metastring:'title="Adh\xe9sion (payload simplifi\xe9)"',children:'{\n  "object": "membership",\n  "pk": "<pk interne>",\n  "uuid": "<uuid de l\'adh\xe9sion>",\n  "state": "<code d\'origine de l\'adh\xe9sion>",\n  "state_display": "<libell\xe9 de l\'origine (ex: LaBoutik, Admin, etc.)>",\n  "datetime": "<date/heure de cr\xe9ation>",\n  "deadline": "<\xe9ch\xe9ance de l\'adh\xe9sion>",\n  "email": "<email de l\'adh\xe9rent ou \'Anonymous <num_carte>\'>",\n  "comment": "<commentaire>",\n  "first_name": "<pr\xe9nom>",\n  "last_name": "<nom>",\n  "pseudo": "<pseudo si renseign\xe9>",\n  "price_name": "<nom du tarif>",\n  "price_uuid": "<uuid du tarif>",\n  "product_name": "<nom du produit>",\n  "product_uuid": "<uuid du produit>",\n  "organisation": "<nom de l\'organisation>",\n  "organisation_id": "<uuid de l\'organisation>",\n\n  "user": "<uuid de l\'utilisateur si li\xe9>",\n  "card_number": "<num\xe9ro de carte si anonyme>",\n  "date_added": "<date d\'ajout>",\n  "last_action": "<derni\xe8re pr\xe9sence>",\n  "last_contribution": "<date du dernier paiement>",\n  "contribution_value": 25.0,\n  "payment_method": "<code moyen de paiement>",\n  "payment_method_name": "<libell\xe9 moyen de paiement>",\n  "newsletter": true,\n  "postal_code": 75000,\n  "birth_date": "1990-01-01",\n  "phone": "+33...",\n  "is_valid": true,\n  "asset_fedow": "<uuid fedow si li\xe9>",\n  "stripe_id_subscription": "<id stripe si abo>",\n  "last_stripe_invoice": "<id facture stripe>",\n  "member_name": "<Nom affich\xe9 de l\'adh\xe9rent>",\n  "product_img": "<URL image produit>",\n  "option_generale": [\n    {"uuid": "...", "name": "...", "description": "...", "poids": 0},\n    {"uuid": "...", "name": "...", "description": "...", "poids": 1}\n  ],\n  "option_names": ["Option 1", "Option 2"]\n}\n'})}),"\n",(0,o.jsx)(n.p,{children:"Notes :"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Beaucoup de champs peuvent \xeatre ",(0,o.jsx)(n.code,{children:"null"}),"/vides selon les cas (ex: utilisateur anonyme, absence de produit, etc.)."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"is_valid"})," est true si la deadline est dans le futur (adh\xe9sion valide \xe0 l\u2019instant T)."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"email"})," peut valoir ",(0,o.jsx)(n.code,{children:'"Anonymous <num_carte>"'})," tant que l\u2019e\u2011mail n\u2019est pas li\xe9."]}),"\n",(0,o.jsxs)(n.li,{children:["Les options sont fournies sous forme compl\xe8te (",(0,o.jsx)(n.code,{children:"option_generale"}),") et sous forme de liste de noms (",(0,o.jsx)(n.code,{children:"option_names"}),")."]}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"r\xe9capitulatif-des-principaux-champs-adh\xe9sion",children:"R\xe9capitulatif des principaux champs (Adh\xe9sion)"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:'object: toujours "membership".'}),"\n",(0,o.jsx)(n.li,{children:"pk / uuid: identifiants internes."}),"\n",(0,o.jsx)(n.li,{children:"state / state_display: origine de la cr\xe9ation (Admin, Import, Paiement unique, Renouvellement auto, LaBoutik...)."}),"\n",(0,o.jsx)(n.li,{children:"datetime: date de cr\xe9ation de l\u2019adh\xe9sion."}),"\n",(0,o.jsx)(n.li,{children:"deadline: \xe9ch\xe9ance calcul\xe9e de l\u2019adh\xe9sion."}),"\n",(0,o.jsx)(n.li,{children:"is_valid: validit\xe9 au moment de l\u2019envoi (deadline > maintenant)."}),"\n",(0,o.jsx)(n.li,{children:"email, first_name, last_name, pseudo: informations d\u2019identit\xe9 (peuvent \xeatre vides/anonymes)."}),"\n",(0,o.jsx)(n.li,{children:"price_* / product_*: informations tarif/produit de l\u2019adh\xe9sion."}),"\n",(0,o.jsx)(n.li,{children:"organisation / organisation_id: informations de l\u2019organisation \xe9mettrice."}),"\n",(0,o.jsx)(n.li,{children:"payment_method / payment_method_name / contribution_value: informations de paiement."}),"\n",(0,o.jsx)(n.li,{children:"option_generale / option_names: options li\xe9es \xe0 l\u2019adh\xe9sion."}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(c,{...e})}):c(e)}},28453:(e,n,i)=>{i.d(n,{R:()=>a,x:()=>r});var t=i(96540);const o={},s=t.createContext(o);function a(e){const n=t.useContext(s);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:a(e.components),t.createElement(s.Provider,{value:n},e.children)}}}]);