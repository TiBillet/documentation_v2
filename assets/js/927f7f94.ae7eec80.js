"use strict";(self.webpackChunkdocumentation_v_2=self.webpackChunkdocumentation_v_2||[]).push([[1329],{9878:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>o,contentTitle:()=>d,default:()=>a,frontMatter:()=>r,metadata:()=>l,toc:()=>c});var s=t(4848),i=t(8453);const r={sidebar_position:10,slug:"development",title:"Development",keywords:["contribute","volunteer","open source","git","pull request","issue","help","code","development","programming","python","django","docker","poetry","testing","tdd"],tags:["contribute","open source","git","help","tdd","python","django","docker","poetry"],authors:"kaya, guillaume"},d="Development",l={id:"contribute/dev",title:"Development",description:"So, you want to help with the development of TiBillet. Thank you! Open-source thrives thanks to people like you \ud83d\ude4f",source:"@site/docs/contribute/dev.md",sourceDirName:"contribute",slug:"/contribute/development",permalink:"/docs/contribute/development",draft:!1,unlisted:!1,editUrl:"https://github.com/TiBillet/documentation_v2/tree/main/docs/contribute/dev.md",tags:[{inline:!0,label:"contribute",permalink:"/docs/tags/contribute"},{inline:!0,label:"open source",permalink:"/docs/tags/open-source"},{inline:!0,label:"git",permalink:"/docs/tags/git"},{inline:!0,label:"help",permalink:"/docs/tags/help"},{inline:!0,label:"tdd",permalink:"/docs/tags/tdd"},{inline:!0,label:"python",permalink:"/docs/tags/python"},{inline:!0,label:"django",permalink:"/docs/tags/django"},{inline:!0,label:"docker",permalink:"/docs/tags/docker"},{inline:!0,label:"poetry",permalink:"/docs/tags/poetry"}],version:"current",sidebarPosition:10,frontMatter:{sidebar_position:10,slug:"development",title:"Development",keywords:["contribute","volunteer","open source","git","pull request","issue","help","code","development","programming","python","django","docker","poetry","testing","tdd"],tags:["contribute","open source","git","help","tdd","python","django","docker","poetry"],authors:"kaya, guillaume"},sidebar:"tutorialSidebar",previous:{title:"Contributing",permalink:"/docs/category/contributing"},next:{title:"Research",permalink:"/docs/category/research"}},o={},c=[{value:"Understanding the workflow",id:"understanding-the-workflow",level:2},{value:"Tools and languages used",id:"tools-and-languages-used",level:2},{value:"Simple local install",id:"simple-local-install",level:2},{value:"Detailed local installation",id:"installation-locale-detaillee",level:2},{value:"Key generation",id:"key-generation",level:3},{value:"Fedow, Lespass, LaBoutik",id:"fedow-lespass-laboutik",level:3},{value:"Fedow environment",id:"fedow-environment",level:4},{value:"Lespass environment",id:"lespass-environment",level:4},{value:"LaBoutik environment",id:"laboutik-environment",level:4},{value:"Tests setup",id:"tests-setup",level:3},{value:"Manual engine start",id:"manual-engine-start",level:2},{value:"Is it working?",id:"is-it-working",level:3},{value:"Lifecycle",id:"lifecycle",level:2},{value:"Updates",id:"updates",level:3},{value:"Testing",id:"testing",level:3},{value:"Backups",id:"backups",level:3}];function h(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"development",children:"Development"})}),"\n",(0,s.jsx)(n.p,{children:"So, you want to help with the development of TiBillet. Thank you! Open-source thrives thanks to people like you \ud83d\ude4f"}),"\n",(0,s.jsxs)(n.p,{children:["First, if you don't have a specific task in mind already, check out the open issues on the official ",(0,s.jsx)(n.a,{href:"https://github.com/TiBillet",children:"Github repositories"}),"."]}),"\n",(0,s.jsx)(n.p,{children:"It's the easiest way to figure out what problem needs fixing or what feature is being requested."}),"\n",(0,s.jsxs)(n.admonition,{title:"Repositories",type:"note",children:[(0,s.jsx)(n.p,{children:"What you need is probably in the pinned repositories. If you are unsure of the role of Fedow, LaBoutik or Lespass, check out the basics on the three TiBillet engines."}),(0,s.jsxs)(n.p,{children:[(0,s.jsx)("mark",{children:"TODO: link to engines and their roles in the doc"})," (a very basic page in intro probably)"]})]}),"\n",(0,s.jsx)(n.h2,{id:"understanding-the-workflow",children:"Understanding the workflow"}),"\n",(0,s.jsxs)(n.p,{children:["When you work with ",(0,s.jsx)(n.em,{children:"Git forges"})," like Github, there are ways in which you can make your contributions easier to handle:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["If you're not part of the core team, ",(0,s.jsx)(n.em,{children:"fork"})," the repository that interests you, work from there, and submit your changes through a ",(0,s.jsx)(n.em,{children:"pull request"}),"."]}),"\n",(0,s.jsx)(n.li,{children:"If you have an issue you want to work on, check that it doesn't already exists. If it does, join the discussion instead of doing your own thing!"}),"\n",(0,s.jsxs)(n.li,{children:["When you start working on an issue, ",(0,s.jsx)(n.strong,{children:"assign yourself"})," to let others know you're working on it."]}),"\n",(0,s.jsxs)(n.li,{children:["Last but not least: ",(0,s.jsx)(n.strong,{children:"don't create pull requests without running the tests"}),"! Happens to the best of us. Ideally, you should run them before committing, with the help of a ",(0,s.jsx)(n.em,{children:"git hook"})," for example."]}),"\n"]}),"\n",(0,s.jsx)(n.admonition,{title:"Getting help",type:"note",children:(0,s.jsxs)(n.p,{children:["If you have any questions regarding Git, Github, or an aspect of development, join us on ",(0,s.jsx)(n.a,{href:"https://discord.gg/7FJvtYx",children:"Discord"})," or ",(0,s.jsx)(n.a,{href:"https://matrix.to/#/#tibillet:tiers-lieux.org",children:"Matrix"})," or ",(0,s.jsx)(n.a,{href:"https://pouet.chapril.org/@tibillet",children:"Mastodon"}),". These are mostly French-speaking spaces as the founders are from La Reunion, but we'll do our best to help (with a bit of ",(0,s.jsx)(n.em,{children:"un accent"})," \ud83c\udf77\ud83e\udd56)."]})}),"\n",(0,s.jsx)(n.h2,{id:"tools-and-languages-used",children:"Tools and languages used"}),"\n",(0,s.jsx)(n.p,{children:"TiBillet is:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"https://www.python.org/",children:"Python"})," software"]}),"\n",(0,s.jsxs)(n.li,{children:["developed with the help of the ",(0,s.jsx)(n.a,{href:"https://www.djangoproject.com/",children:"Django"})," framework"]}),"\n",(0,s.jsxs)(n.li,{children:["its dependencies are handled through ",(0,s.jsx)(n.a,{href:"https://python-poetry.org/",children:"Poetry"})]}),"\n",(0,s.jsxs)(n.li,{children:["it runs in ",(0,s.jsx)(n.a,{href:"https://www.docker.com/",children:"Docker"})," containers for production as well as development"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"If you don't feel at ease with the software stack, the best thing you can do is to go look for tutorials. Hopefully we'll compile a list of our own down here one of these days \ud83d\ude05"}),"\n",(0,s.jsx)(n.admonition,{type:"warning",children:(0,s.jsx)(n.p,{children:"In particular, basic knowledge of Git can help. It is relatively easy to make a complete mess of a project by not grasping the way versioning works. There are safeguards, but you might struggle a lot more than necessary! I remember how that feels \ud83d\ude11"})}),"\n",(0,s.jsx)(n.h2,{id:"simple-local-install",children:"Simple local install"}),"\n",(0,s.jsx)(n.p,{children:"In order to develop and test things out, you're gonna need a (mostly) functional instance of TiBillet on your computer."}),"\n",(0,s.jsx)(n.p,{children:"Let's make sure you have the required tools at hand. You need:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Docker CLI and the ",(0,s.jsx)(n.code,{children:"docker-compose"})," extension"]}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"git"})}),"\n",(0,s.jsx)(n.li,{children:"a Github account with a registered SSH key for forge access"}),"\n",(0,s.jsx)(n.li,{children:"an IDE (there are open-source gift licenses of PyCharm available on request, but a regular IDE like VSCodium works reasonably well - that's what I'm using \ud83d\ude09)"}),"\n"]}),"\n",(0,s.jsxs)(n.admonition,{type:"info",children:[(0,s.jsx)(n.p,{children:"From here, you can choose between two paths:"}),(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["The ",(0,s.jsx)(n.strong,{children:"Too easy !"})," path: ",(0,s.jsx)(n.a,{href:"https://nuage.tierslieux.re/s/rprGfbDDDrazJ9d",children:"I download an archive"})," in which everything is already installed and I can go straight to ",(0,s.jsx)(n.a,{href:"#manual-engine-start",children:"engine startup"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:["The ",(0,s.jsx)(n.strong,{children:"I want to understand! path"}),": Each step in creating your environment is detailed in the ",(0,s.jsx)(n.a,{href:"#installation-locale-detaillee",children:"tuto below"}),"."]}),"\n"]}),(0,s.jsx)(n.p,{children:"You can even do both, for maximum effect!"})]}),"\n",(0,s.jsx)(n.h2,{id:"installation-locale-detaillee",children:"Detailed local installation"}),"\n",(0,s.jsx)(n.p,{children:"Translated with DeepL.com (free version)\nWe're gonna start by creating a folder that will hold the different repositories required, in your local repository or work folder if you have one for example. It will look like this:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"tibillet-dev\n\u251c\u2500\u2500 Fedow\n\u251c\u2500\u2500 LaBoutik\n\u251c\u2500\u2500 Lespass\n\u251c\u2500\u2500 Test-Driven-Development\n\u2514\u2500\u2500 Traefik\n"})}),"\n",(0,s.jsx)(n.h3,{id:"key-generation",children:"Key generation"}),"\n",(0,s.jsx)("mark",{children:"TODO: Complicated and heavy for no reason."}),"\n",(0,s.jsx)(n.p,{children:"The legacy way of generating the necessary configuration keys is to pull the production Fedow docker image and run poetry inside of it."}),"\n",(0,s.jsx)(n.p,{children:"For each engine, we will need:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["one or two Fernet keys (for the ",(0,s.jsx)(n.code,{children:"FERNET_KEY"})," field and possibly, passwords)"]}),"\n",(0,s.jsxs)(n.li,{children:["a Django secret key (for the ",(0,s.jsx)(n.code,{children:"SECRET_KEY"})," field)"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"You can generate 30 of each in your terminal by running:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"docker run --rm tibillet/fedow poetry run python3 -c \"from cryptography.fernet import Fernet; print('\\n'.join([Fernet.generate_key().decode('utf-8') for i in range(0,30)]))\"\ndocker run --rm tibillet/fedow poetry run python3 -c \"from django.core.management.utils import get_random_secret_key; print('\\n'.join([get_random_secret_key() for i in range(0,30)]))\"\n"})}),"\n",(0,s.jsx)(n.p,{children:"The first line will take some time as it need to pull the entire Docker image. Keep the keys somewhere, we're gonna need them to setup the engines."}),"\n",(0,s.jsxs)(n.p,{children:["We're also going to need a Stripe test key for the ",(0,s.jsx)(n.code,{children:"STRIPE_KEY_TEST"})," field. Stripe is the payment solution that is currently taking care of the cashing in. You can obtain a key by creating a free account, then by going to Test mode -> API test key. Alternatively you can ask the team."]}),"\n",(0,s.jsx)(n.h3,{id:"fedow-lespass-laboutik",children:"Fedow, Lespass, LaBoutik"}),"\n",(0,s.jsx)(n.p,{children:"Start by cloning the repositories:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",metastring:'title="tibillet-dev$"',children:"git clone git@github.com:TiBillet/Fedow.git\ngit clone git@github.com:TiBillet/Lespass.git\ngit clone git@github.com:TiBillet/LaBoutik.git\n"})}),"\n",(0,s.jsx)(n.p,{children:"From here, we need to write a bit of configuration. It will be better streamlined in the future, so bear with us \ud83d\ude0b"}),"\n",(0,s.jsxs)(n.p,{children:["Each engine needs its own ",(0,s.jsx)(n.code,{children:".env"})," file, which you can base on the ",(0,s.jsx)(n.code,{children:"env_example"})," files you cloned."]}),"\n",(0,s.jsx)(n.admonition,{type:"warning",children:(0,s.jsxs)(n.p,{children:["Each environment variable must be readable from the ",(0,s.jsx)(n.code,{children:".env"})," file. No line deletion! Some of them can however stay empty (nullable)."]})}),"\n",(0,s.jsx)(n.h4,{id:"fedow-environment",children:"Fedow environment"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",metastring:'title="tibillet-dev$"',children:"cp Fedow/env_example Fedow/.env\n"})}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Name"}),(0,s.jsx)(n.th,{children:"Target environment"}),(0,s.jsx)(n.th,{children:"Nullable"}),(0,s.jsx)(n.th,{children:"Default value"}),(0,s.jsx)(n.th,{children:"Notes"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"SECRET_KEY"})}),(0,s.jsx)(n.td,{children:"All"}),(0,s.jsx)(n.td,{children:"No"}),(0,s.jsx)(n.td,{}),(0,s.jsx)(n.td,{children:"One of the previously generated Django secret key"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"FERNET_KEY"})}),(0,s.jsx)(n.td,{children:"All"}),(0,s.jsx)(n.td,{children:"No"}),(0,s.jsx)(n.td,{}),(0,s.jsx)(n.td,{children:"One of the previously generated Fernet key"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"STRIPE_KEY"})}),(0,s.jsx)(n.td,{children:"Production"}),(0,s.jsx)(n.td,{children:"Yes"}),(0,s.jsx)(n.td,{}),(0,s.jsx)(n.td,{children:"Your Stripe API key"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"DOMAIN"})}),(0,s.jsx)(n.td,{children:"All"}),(0,s.jsx)(n.td,{children:"No"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"fedow.tibillet.localhost"})}),(0,s.jsx)(n.td,{children:"Change to you domain and subdomain for production mode"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"STRIPE_KEY_TEST"})}),(0,s.jsx)(n.td,{children:"Development, Testing"}),(0,s.jsx)(n.td,{children:"Yes"}),(0,s.jsx)(n.td,{}),(0,s.jsx)(n.td,{children:"Your Stripe API test key"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"STRIPE_TEST"})}),(0,s.jsx)(n.td,{children:"Development, Testing"}),(0,s.jsx)(n.td,{children:"No"}),(0,s.jsx)(n.td,{children:"0"}),(0,s.jsxs)(n.td,{children:["Set to 1 if ",(0,s.jsx)(n.code,{children:"STRIPE_KEY_TEST"})," is filled"]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"STRIPE_ENDPOINT_SECRET_TEST"})}),(0,s.jsx)(n.td,{children:"Development, Testing"}),(0,s.jsx)(n.td,{children:"Yes"}),(0,s.jsx)(n.td,{}),(0,s.jsx)(n.td,{children:"No idea"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"DEBUG"})}),(0,s.jsx)(n.td,{children:"Development"}),(0,s.jsx)(n.td,{children:"No"}),(0,s.jsx)(n.td,{children:"0"}),(0,s.jsx)(n.td,{children:"Set to 1 for development"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"TEST"})}),(0,s.jsx)(n.td,{children:"Testing"}),(0,s.jsx)(n.td,{children:"No"}),(0,s.jsx)(n.td,{children:"0"}),(0,s.jsx)(n.td,{children:"Set to 1 for testing"})]})]})]}),"\n",(0,s.jsx)(n.h4,{id:"lespass-environment",children:"Lespass environment"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",metastring:'title="tibillet-dev$"',children:"cp Lespass/env_example Lespass/.env\n"})}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Name"}),(0,s.jsx)(n.th,{children:"Target environment"}),(0,s.jsx)(n.th,{children:"Nullable"}),(0,s.jsx)(n.th,{children:"Default value"}),(0,s.jsx)(n.th,{children:"Notes"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"SECRET_KEY"})}),(0,s.jsx)(n.td,{children:"All"}),(0,s.jsx)(n.td,{children:"No"}),(0,s.jsx)(n.td,{}),(0,s.jsx)(n.td,{children:"One of the previously generated Django secret key"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"FERNET_KEY"})}),(0,s.jsx)(n.td,{children:"All"}),(0,s.jsx)(n.td,{children:"No"}),(0,s.jsx)(n.td,{}),(0,s.jsx)(n.td,{children:"One of the previously generated Fernet key"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"STRIPE_KEY"})}),(0,s.jsx)(n.td,{children:"Production"}),(0,s.jsx)(n.td,{children:"Yes"}),(0,s.jsx)(n.td,{}),(0,s.jsx)(n.td,{children:"Your Stripe API key"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"DOMAIN"})}),(0,s.jsx)(n.td,{children:"All"}),(0,s.jsx)(n.td,{children:"No"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"tibillet.localhost"})}),(0,s.jsx)(n.td,{children:"Change to your domain for production mode"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"SUB"})}),(0,s.jsx)(n.td,{children:"All"}),(0,s.jsx)(n.td,{children:"No"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"lespass"})}),(0,s.jsx)(n.td,{children:"Instance subdomain, change for production mode as necessary"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"META"})}),(0,s.jsx)(n.td,{children:"All"}),(0,s.jsx)(n.td,{children:"No"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"agenda"})}),(0,s.jsx)(n.td,{children:"Federated calendar subdomain, change for production mode as necessary"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"FEDOW_DOMAIN"})}),(0,s.jsx)(n.td,{children:"All"}),(0,s.jsx)(n.td,{children:"No"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"fedow.tibillet.localhost"})}),(0,s.jsx)(n.td,{children:"Domain and subdomain of the Fedow engine"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"PUBLIC"})}),(0,s.jsx)(n.td,{children:"All"}),(0,s.jsx)(n.td,{children:"No"}),(0,s.jsx)(n.td,{children:"TiBillet Coop."}),(0,s.jsx)(n.td,{children:"Main instance name"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"TIME_ZONE"})}),(0,s.jsx)(n.td,{children:"All"}),(0,s.jsx)(n.td,{children:"No"}),(0,s.jsx)(n.td,{children:"Europe/Paris"}),(0,s.jsx)(n.td,{children:"TZ time zone of the instance"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"ADMIN_EMAIL"})}),(0,s.jsx)(n.td,{children:"All"}),(0,s.jsx)(n.td,{children:"No"}),(0,s.jsx)(n.td,{}),(0,s.jsx)(n.td,{children:"Admin email (for the first admin)"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"POSTGRES_DB"})}),(0,s.jsx)(n.td,{children:"All"}),(0,s.jsx)(n.td,{children:"No"}),(0,s.jsx)(n.td,{children:"lespass"}),(0,s.jsx)(n.td,{children:"Change for production mode if necessary"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"POSTGRES_USER"})}),(0,s.jsx)(n.td,{children:"All"}),(0,s.jsx)(n.td,{children:"No"}),(0,s.jsx)(n.td,{children:"lespass_postgres"}),(0,s.jsx)(n.td,{children:"Change for production mode"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"POSTGRES_PASSWORD"})}),(0,s.jsx)(n.td,{children:"All"}),(0,s.jsx)(n.td,{children:"No"}),(0,s.jsx)(n.td,{}),(0,s.jsx)(n.td,{children:"Strong password (one of the Fernet keys for example)"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.code,{children:"EMAIL_HOST"}),", ",(0,s.jsx)(n.code,{children:"EMAIL_PORT"}),", ",(0,s.jsx)(n.code,{children:"EMAIL_HOST_USER"}),", ",(0,s.jsx)(n.code,{children:"EMAIL_HOST_PASSWORD"})]}),(0,s.jsx)(n.td,{children:"All"}),(0,s.jsx)(n.td,{children:"Yes"}),(0,s.jsx)(n.td,{}),(0,s.jsx)(n.td,{children:"Email server, required to confirm user registrations for example"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"STRIPE_KEY_TEST"})}),(0,s.jsx)(n.td,{children:"Development, Testing"}),(0,s.jsx)(n.td,{children:"Yes"}),(0,s.jsx)(n.td,{}),(0,s.jsx)(n.td,{children:"Your Stripe API test key"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"STRIPE_TEST"})}),(0,s.jsx)(n.td,{children:"Development, Testing"}),(0,s.jsx)(n.td,{children:"No"}),(0,s.jsx)(n.td,{children:"0"}),(0,s.jsxs)(n.td,{children:["Set to 1 if ",(0,s.jsx)(n.code,{children:"STRIPE_KEY_TEST"})," is filled"]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"DEBUG"})}),(0,s.jsx)(n.td,{children:"Development"}),(0,s.jsx)(n.td,{children:"No"}),(0,s.jsx)(n.td,{children:"0"}),(0,s.jsx)(n.td,{children:"Set to 1 for development"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"TEST"})}),(0,s.jsx)(n.td,{children:"Testing"}),(0,s.jsx)(n.td,{children:"No"}),(0,s.jsx)(n.td,{children:"0"}),(0,s.jsx)(n.td,{children:"Set to 1 for testing"})]})]})]}),"\n",(0,s.jsx)(n.h4,{id:"laboutik-environment",children:"LaBoutik environment"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",metastring:'title="tibillet-dev$"',children:"cp LaBoutik/env_example LaBoutik/.env\n"})}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Name"}),(0,s.jsx)(n.th,{children:"Target environment"}),(0,s.jsx)(n.th,{children:"Nullable"}),(0,s.jsx)(n.th,{children:"Default value"}),(0,s.jsx)(n.th,{children:"Notes"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"SECRET_KEY"})}),(0,s.jsx)(n.td,{children:"All"}),(0,s.jsx)(n.td,{children:"No"}),(0,s.jsx)(n.td,{}),(0,s.jsx)(n.td,{children:"One of the previously generated Django secret key"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"FERNET_KEY"})}),(0,s.jsx)(n.td,{children:"All"}),(0,s.jsx)(n.td,{children:"No"}),(0,s.jsx)(n.td,{}),(0,s.jsx)(n.td,{children:"One of the previously generated Fernet key"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"DOMAIN"})}),(0,s.jsx)(n.td,{children:"All"}),(0,s.jsx)(n.td,{children:"No"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"laboutik.tibillet.localhost"})}),(0,s.jsx)(n.td,{children:"Change to you domain and subdomain for production mode"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"FEDOW_URL"})}),(0,s.jsx)(n.td,{children:"All"}),(0,s.jsx)(n.td,{children:"No"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.a,{href:"https://fedow.tibillet.localhost/",children:"https://fedow.tibillet.localhost/"})}),(0,s.jsx)(n.td,{children:"Fedow engine URL"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"LESPASS_TENANT_URL"})}),(0,s.jsx)(n.td,{children:"All"}),(0,s.jsx)(n.td,{children:"No"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.a,{href:"https://lespass.tibillet.localhost/",children:"https://lespass.tibillet.localhost/"})}),(0,s.jsx)(n.td,{children:"Lespass instance URL"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"TIME_ZONE"})}),(0,s.jsx)(n.td,{children:"All"}),(0,s.jsx)(n.td,{children:"No"}),(0,s.jsx)(n.td,{children:"Europe/Paris"}),(0,s.jsx)(n.td,{children:"TZ time zone of the instance"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"ADMIN_EMAIL"})}),(0,s.jsx)(n.td,{children:"All"}),(0,s.jsx)(n.td,{children:"No"}),(0,s.jsx)(n.td,{}),(0,s.jsx)(n.td,{children:"Admin email (for the first admin)"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"MAIN_ASSET_NAME"})}),(0,s.jsx)(n.td,{children:"All"}),(0,s.jsx)(n.td,{children:"No"}),(0,s.jsx)(n.td,{}),(0,s.jsx)(n.td,{children:"Name of your main cashless asset (Centiment, HeartBit\u2026 whatever you like)"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"POSTGRES_DB"})}),(0,s.jsx)(n.td,{children:"All"}),(0,s.jsx)(n.td,{children:"No"}),(0,s.jsx)(n.td,{children:"laboutik"}),(0,s.jsx)(n.td,{children:"Change for production mode if necessary"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"POSTGRES_USER"})}),(0,s.jsx)(n.td,{children:"All"}),(0,s.jsx)(n.td,{children:"No"}),(0,s.jsx)(n.td,{children:"laboutik_user"}),(0,s.jsx)(n.td,{children:"Change for production mode"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"POSTGRES_PASSWORD"})}),(0,s.jsx)(n.td,{children:"All"}),(0,s.jsx)(n.td,{children:"No"}),(0,s.jsx)(n.td,{}),(0,s.jsx)(n.td,{children:"Strong password (one of the Fernet keys for example)"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.code,{children:"EMAIL_HOST"}),", ",(0,s.jsx)(n.code,{children:"EMAIL_PORT"}),", ",(0,s.jsx)(n.code,{children:"EMAIL_HOST_USER"}),", ",(0,s.jsx)(n.code,{children:"EMAIL_HOST_PASSWORD"})]}),(0,s.jsx)(n.td,{children:"All"}),(0,s.jsx)(n.td,{children:"Yes"}),(0,s.jsx)(n.td,{}),(0,s.jsx)(n.td,{children:"Email server, required to confirm user registrations for example"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"BORG_PASSPHRASE"})}),(0,s.jsx)(n.td,{children:"All"}),(0,s.jsx)(n.td,{children:"Yes"}),(0,s.jsx)(n.td,{}),(0,s.jsx)(n.td,{children:"Password used for data backup"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"DEBUG"})}),(0,s.jsx)(n.td,{children:"Development"}),(0,s.jsx)(n.td,{children:"No"}),(0,s.jsx)(n.td,{children:"0"}),(0,s.jsx)(n.td,{children:"Set to 1 for development"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"TEST"})}),(0,s.jsx)(n.td,{children:"Testing"}),(0,s.jsx)(n.td,{children:"No"}),(0,s.jsx)(n.td,{children:"0"}),(0,s.jsx)(n.td,{children:"Set to 1 for testing"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"DEMO"})}),(0,s.jsx)(n.td,{children:"Development, Testing"}),(0,s.jsx)(n.td,{children:"No"}),(0,s.jsx)(n.td,{children:"0"}),(0,s.jsx)(n.td,{children:"Set to 1 for a register simulation"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"SENTRY_DNS"})}),(0,s.jsx)(n.td,{children:"Development, Testing"}),(0,s.jsx)(n.td,{children:"Yes"}),(0,s.jsx)(n.td,{}),(0,s.jsx)(n.td,{children:"Sentry Debug pour le back-end"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.code,{children:"SENTRY_FRONT_DNS"}),", ",(0,s.jsx)(n.code,{children:"SENTRY_FRONT_ASSET"})]}),(0,s.jsx)(n.td,{children:"Development, Testing"}),(0,s.jsx)(n.td,{children:"Yes"}),(0,s.jsx)(n.td,{}),(0,s.jsx)(n.td,{children:"Sentry Debug for front-end"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.code,{children:"DEMO_TAGID_CM"}),", ",(0,s.jsx)(n.code,{children:"DEMO_TAGID_CLIENT1"}),", ",(0,s.jsx)(n.code,{children:"DEMO_TAGID_CLIENT2"})]}),(0,s.jsx)(n.td,{}),(0,s.jsx)(n.td,{children:"Yes"}),(0,s.jsx)(n.td,{}),(0,s.jsx)(n.td,{children:"No idea"})]})]})]}),"\n",(0,s.jsx)(n.p,{children:"The configuration should now be complete for the TiBillet engines."}),"\n",(0,s.jsx)(n.h3,{id:"tests-setup",children:"Tests setup"}),"\n",(0,s.jsx)(n.p,{children:"For\u2026 reasons, the entire dev environment is assembled through the tests. The setup of the testing repository might seem familiar:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",metastring:'title="tibillet-dev$"',children:"git clone git@github.com:TiBillet/Test-Driven-Development.git\ncp Test-Driven-Development/env_example Test-Driven-Development/.env\n"})}),"\n",(0,s.jsx)(n.p,{children:"There! Setup done \u263a\ufe0f Now we can start running the entire project from inside the test folder:"}),"\n",(0,s.jsx)(n.h2,{id:"manual-engine-start",children:"Manual engine start"}),"\n",(0,s.jsx)(n.admonition,{type:"warning",children:(0,s.jsx)(n.p,{children:"If you've downloaded the ready-to-install folder, remember to perform a git pull in each of the 4 repositories before launching!"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",metastring:'title="Test-Driven-Development$"',children:"docker network create frontend # only the first time. Traefik need this virtual network.\ndocker compose up -d\n"})}),"\n",(0,s.jsx)(n.p,{children:"You can access the logs with:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",metastring:'title="Test-Driven-Development$"',children:"docker compose logs -f\n"})}),"\n",(0,s.jsx)(n.p,{children:"To delete the containers :"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",metastring:'title="Test-Driven-Development$"',children:"docker compose down -v # -v for the volumes used by database.\n"})}),"\n",(0,s.jsx)(n.admonition,{title:"Careful!",type:"warning",children:(0,s.jsxs)(n.p,{children:["This particular ",(0,s.jsx)(n.code,{children:"docker-compose.yml"})," relies on the folder structure of its ",(0,s.jsx)(n.em,{children:"parent folder"})," shown in the beginning with the example name of ",(0,s.jsx)(n.code,{children:"tibillet-dev"}),". Counterintuitive, but hey: now you know!"]})}),"\n",(0,s.jsxs)(n.p,{children:["The main difference between dev and prod containers is that running the ",(0,s.jsx)(n.code,{children:"docker compose"})," command will not start the individual Django apps. It's a level of granularity that helps with development, but it means you get to start them manually by entering the containers. Lucky you! \ud83c\udf40"]}),"\n",(0,s.jsx)(n.p,{children:"Were're gonna start them in a particular order:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Fedow"}),"\n",(0,s.jsx)(n.li,{children:"Lespass"}),"\n",(0,s.jsx)(n.li,{children:"LaBoutik (needs the other two to start)"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["The tools we need are in the Django containers, named after the engines: ",(0,s.jsx)(n.code,{children:"fedow_django"}),", ",(0,s.jsx)(n.code,{children:"lespass_django"})," and ",(0,s.jsx)(n.code,{children:"laboutik_django"}),". To enter a container (Fedow example) :"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# starting bash shell in fedow_django container\ndocker exec -ti fedow_django bash\n"})}),"\n",(0,s.jsx)(n.p,{children:"From there we have a few options."}),"\n",(0,s.jsxs)(n.p,{children:["First is the ",(0,s.jsx)(n.code,{children:"flush.sh"})," script. It initializes testing data and starts the app right after. This is what we're gonna use at ",(0,s.jsx)(n.strong,{children:"first boot"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",metastring:'title="fedow_django$"',children:"./flush.sh\n"})}),"\n",(0,s.jsxs)(n.p,{children:["We will also use it when we want to ",(0,s.jsx)(n.strong,{children:"reset"})," data, for example before starting the automated testing with relies on this predictible data."]}),"\n",(0,s.jsx)(n.p,{children:"For the rest of the container manipulations, we're going to need the Poetry shell, because we're gonna use Python commands."}),"\n",(0,s.jsx)(n.p,{children:"To start Poetry's virtual env from the container:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",metastring:'title="fedow_django$"',children:" # we start the virtual env that handles the python dependencies\npoetry shell\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Django is handled through a script called ",(0,s.jsx)(n.code,{children:"manage.py"}),". Two commands are of interest to us here:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"rsp"})," (alias of  ",(0,s.jsx)(n.code,{children:"./manage.py runserver 0.0.0.0:8000"}),") starts Django but doesn't wipe out the data. This will help keep data between sessions. GThis command is used in most cases, ",(0,s.jsx)(n.code,{children:"flush"})," is only used for testing or when something's gonz wrong."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["As an option, if you're encontering graphical issues (such as assets not loading), you can attempt ",(0,s.jsx)(n.code,{children:"./manage.py collectstatic"}),". Sometimes the graphical assets are not properly collected at first boot, in which case this can help."]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Only thing left to do is to start the three engines in the order described earlier : Fedow, Lespass, then LaBoutik !"}),"\n",(0,s.jsxs)(n.admonition,{title:"Aliasing",type:"tip",children:[(0,s.jsx)(n.p,{children:"The docker command gets repetitive after a while. Why not create an alias, or even a little bash function that will shorten your labor and preserve your carpal tunnel? Here's mine:"}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",metastring:'title="~/.bashrc"',children:"function dockex {\n    docker exec -ti $1 bash\n}\n"})}),(0,s.jsx)(n.p,{children:"There's probably even a way to add the poetry stuff to it, look it up!"})]}),"\n",(0,s.jsx)(n.h3,{id:"is-it-working",children:"Is it working?"}),"\n",(0,s.jsx)(n.p,{children:"If you have used the default domain configuration, you can now access:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["the federation engine Fedow at ",(0,s.jsx)(n.a,{href:"https://fedow.tibillet.localhost",children:"fedow.tibillet.localhost"})]}),"\n",(0,s.jsxs)(n.li,{children:["an instance of the ticketing engine Lespass at ",(0,s.jsx)(n.a,{href:"https://lespass.tibillet.localhost",children:"lespass.tibillet.localhost"})]}),"\n",(0,s.jsxs)(n.li,{children:["the currency register server LaBoutik at ",(0,s.jsx)(n.a,{href:"https://laboutik.tibillet.localhost",children:"laboutik.tibillet.localhost"})]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"If everything is working as expected, congratulations: you're ready to go \ud83d\udd27"}),"\n",(0,s.jsx)(n.p,{children:"If not, come talk to us, we'd love to help!"}),"\n",(0,s.jsxs)(n.admonition,{title:"Wrapping up",type:"note",children:[(0,s.jsxs)(n.p,{children:["Don't forget to ",(0,s.jsx)(n.code,{children:"docker compose down"})," both here and in Traefik when you're done. You computer needs a break sometimes."]}),(0,s.jsxs)(n.p,{children:["If you think you won't remember, remove the daemon option when you compose up (",(0,s.jsx)(n.code,{children:"-d"}),") and the command will run directly in the terminal, not as a background job. It's fine, you'll just need more tabs \ud83d\ude0b"]})]}),"\n",(0,s.jsx)(n.h2,{id:"lifecycle",children:"Lifecycle"}),"\n",(0,s.jsx)(n.h3,{id:"updates",children:"Updates"}),"\n",(0,s.jsx)(n.p,{children:"To stay up to date during development, pull the latest image:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",metastring:'title="Test-Driven-Development$"',children:"docker compose pull\ndocker compose up -d # start or restart the updated containers\n"})}),"\n",(0,s.jsx)(n.h3,{id:"testing",children:"Testing"}),"\n",(0,s.jsx)(n.p,{children:"You can run the Python tests through the same shell-ception required to do a manual start. Start by flushing the 3 Django apps to get fresh testing data, then run this inside your LaBoutik Django container:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",metastring:'title="laboutik_django> poetry shell$"',children:"./manage.py test\n"})}),"\n",(0,s.jsx)("mark",{children:"TODO: end-to-end tests docs (they exist!)"}),"\n",(0,s.jsx)(n.h3,{id:"backups",children:"Backups"}),"\n",(0,s.jsxs)(n.p,{children:["Before causing any major change, backup any data that has value to your development. On your Fedow instance, you only need to save the ",(0,s.jsx)(n.code,{children:"database"})," folder regularly. The other engines can be backed up through the Borgbackup util, cron tasks and database dumps. More about this in the future."]}),"\n",(0,s.jsx)("mark",{children:"TODO: detailed backup explanation"})]})}function a(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(h,{...e})}):h(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>d,x:()=>l});var s=t(6540);const i={},r=s.createContext(i);function d(e){const n=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:d(e.components),s.createElement(r.Provider,{value:n},e.children)}}}]);