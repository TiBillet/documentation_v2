"use strict";(self.webpackChunkdocumentation_v_2=self.webpackChunkdocumentation_v_2||[]).push([[8703],{8195:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>i,contentTitle:()=>t,default:()=>h,frontMatter:()=>r,metadata:()=>l,toc:()=>c});var a=s(6271),o=s(1621);const r={sidebar_position:100,slug:"docker_install",title:"Self hosted TiBillet instances",description:"self hosted TiBillet tools with docker",keywords:["cashless","billetterie","ticketing"],wiktags:["cashless","billetterie","ticketing"],authors:"jonas"},t=void 0,l={id:"install/server_install",title:"Self hosted TiBillet instances",description:"self hosted TiBillet tools with docker",source:"@site/docs/install/server_install.md",sourceDirName:"install",slug:"/install/docker_install",permalink:"/docs/install/docker_install",draft:!1,unlisted:!1,editUrl:"https://github.com/TiBillet/documentation_v2/tree/main/docs/install/server_install.md",tags:[],version:"current",sidebarPosition:100,frontMatter:{sidebar_position:100,slug:"docker_install",title:"Self hosted TiBillet instances",description:"self hosted TiBillet tools with docker",keywords:["cashless","billetterie","ticketing"],wiktags:["cashless","billetterie","ticketing"],authors:"jonas"},sidebar:"tutorialSidebar",previous:{title:"Assembly 10inch",permalink:"/docs/install/Raspberry Box/Hardware/10inch"},next:{title:"Contributing",permalink:"/docs/category/contributing"}},i={},c=[{value:"Legal warning",id:"legal-warning",level:2},{value:"Introduction to Engines",id:"introduction-to-engines",level:2},{value:"Generate many Fernet key and django secret key",id:"generate-many-fernet-key-and-django-secret-key",level:3},{value:"Fedow : One ring to rule them all",id:"fedow--one-ring-to-rule-them-all",level:2},{value:"Environment",id:"environment",level:3},{value:"Nginx rules",id:"nginx-rules",level:3},{value:"Docker compose",id:"docker-compose",level:3},{value:"Launch the rocket !",id:"launch-the-rocket-",level:3},{value:"Backup",id:"backup",level:3},{value:"Lespass : Multi tenant engine for membership, ticketing and online cashless refill.",id:"lespass--multi-tenant-engine-for-membership-ticketing-and-online-cashless-refill",level:2},{value:"Environment",id:"environment-1",level:3},{value:"Nginx rules",id:"nginx-rules-1",level:3},{value:"Docker compose",id:"docker-compose-1",level:3},{value:"Launch the rocket !",id:"launch-the-rocket--1",level:3},{value:"Update",id:"update",level:3},{value:"Backups",id:"backups",level:3},{value:"LaBoutik : Cash and cashless registrer. NFC card reader for cashless, membership or badge scan.",id:"laboutik--cash-and-cashless-registrer-nfc-card-reader-for-cashless-membership-or-badge-scan",level:2},{value:"Environment",id:"environment-2",level:3},{value:"Nginx rules",id:"nginx-rules-2",level:3},{value:"Docker compose",id:"docker-compose-2",level:3},{value:"Launch the rocket !",id:"launch-the-rocket--2",level:3},{value:"Update",id:"update-1",level:3},{value:"Backups",id:"backups-1",level:3}];function d(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.h2,{id:"legal-warning",children:"Legal warning"}),"\n",(0,a.jsxs)(n.admonition,{type:"danger",children:[(0,a.jsxs)(n.p,{children:["Since January 1, 2018, in order to combat VAT fraud, all VAT-registered professionals recording\ncustomer payments using one of these software or systems are required to use secure, ",(0,a.jsx)(n.strong,{children:"certified hardware"}),"."]}),(0,a.jsxs)(n.p,{children:["A measure enshrined in\n",(0,a.jsx)(n.a,{href:"https://www.legifrance.gouv.fr/codes/article_lc/LEGIARTI000042914666",children:"Article 286 3\xb0 bis of the General Tax Code"}),"\nand initially stemming from the 2016 Finance Act,\nwhen ",(0,a.jsx)(n.a,{href:"https://www.april.org/reglementation-des-systemes-de-caisse-les-logiciels-libres-de-mieux-en-mieux-pris-en-compte-par-berc",children:"April"}),"\nbecame involved in promoting and defending open-source\nsoftware with cashiering functions."]}),(0,a.jsxs)(n.p,{children:["If you're using ",(0,a.jsx)(n.a,{href:"/docs/presentation/rates",children:"TiBillet's Coop' and SaaS model"}),", you don't need to worry about any of\nthis : We provide you with the certificate."]}),(0,a.jsx)(n.p,{children:"But if you self-host your own cash register instance, you legally become the publisher, and we can't provide you with\nany legal documents to present to the tax authorities."}),(0,a.jsx)(n.p,{children:"I imagine that if you're here, it's to install it yourself ;)"}),(0,a.jsx)(n.p,{children:"Here you are informed!"})]}),"\n",(0,a.jsx)(n.p,{children:"More information here (in french) :"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"https://www.economie.gouv.fr/entreprises/professionnels-logiciels-caisse",children:"https://www.economie.gouv.fr/entreprises/professionnels-logiciels-caisse"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"https://www.april.org/reglementation-des-systemes-de-caisse-les-logiciels-libres-de-mieux-en-mieux-pris-en-compte-par-berc",children:"https://www.april.org/reglementation-des-systemes-de-caisse-les-logiciels-libres-de-mieux-en-mieux-pris-en-compte-par-berc"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"https://www.legifrance.gouv.fr/codes/article_lc/LEGIARTI000042914666",children:"https://www.legifrance.gouv.fr/codes/article_lc/LEGIARTI000042914666"})}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"introduction-to-engines",children:"Introduction to Engines"}),"\n",(0,a.jsx)(n.p,{children:"Tibillet is a software suite composed of several interoperable building blocks. The engines are :"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.a,{href:"https://github.com/TiBillet/Fedow",children:"Fedow"}),": Federated and open wallet, the federation engine. A PoA and Rsa key based\nblockchain to\nshare membership assets, local currencies and\ntime for several Lespass and LaBoutik instances."]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.a,{href:"https://github.com/TiBillet/Lespass",children:"Lespass"}),": Ticketing, booking, membership and landing page engines. Usefull too\nfor refill online with self scanned qrcode unique on each card."]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.a,{href:"https://github.com/TiBillet/LaBoutik",children:"LaBoutik"}),": Cash register, cashless system with RFID / NFC chip and order-taking\nsystem."]}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"To get the full functionality of TiBillet, you need to install these three engines."}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["One ",(0,a.jsx)(n.strong,{children:"Fedow"})," for multiple locations (RSA based PoA blockchain)"]}),"\n",(0,a.jsxs)(n.li,{children:["One ",(0,a.jsx)(n.strong,{children:"Lespass"})," for multiple locations (Django multi-tenant)"]}),"\n",(0,a.jsxs)(n.li,{children:["One ",(0,a.jsx)(n.strong,{children:"Laboutik"})," per location, which connects to a fedow and a lespass to join a federation."]}),"\n"]}),"\n",(0,a.jsx)(n.admonition,{title:"Exemple",type:"note",children:(0,a.jsxs)(n.p,{children:["if you want to use the same NFC card to manage cashless at 2 festivals and 3 community caf\xe9s, you'll need 5\n",(0,a.jsx)(n.strong,{children:"LabouTik"}),", but only one ",(0,a.jsx)(n.strong,{children:"Fedow"})," for the federated asset, and one ",(0,a.jsx)(n.strong,{children:"Lespass"})," for the webpage of each venue.\nThe same applies if you want to manage a co-working subscription for a\ngroup of ",(0,a.jsx)(n.em,{children:"third place"})," in a given city/region/department."]})}),"\n",(0,a.jsx)(n.h1,{id:"requirements-",children:"Requirements :"}),"\n",(0,a.jsxs)(n.p,{children:["For security and performance reasons, we recommend that you separate the ",(0,a.jsx)(n.strong,{children:"Lespass"})," public area from the ",(0,a.jsx)(n.strong,{children:"LaBoutik"}),"\ncheckout and ",(0,a.jsx)(n.strong,{children:"Fedow"})," federation engines."]}),"\n",(0,a.jsx)(n.p,{children:"For dev' and test purpose, you can install everything on one VPS. Here the minimal requirements :"}),"\n",(0,a.jsx)(n.p,{children:"A linux server with :"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"2 vCpu / 4Go Ram"}),"\n",(0,a.jsx)(n.li,{children:"Docker & Compose"}),"\n",(0,a.jsx)(n.li,{children:"1 domain with wildcard capacity"}),"\n",(0,a.jsx)(n.li,{children:"A Reverse proxy who handle 443 and 80 port (we use Traefik)"}),"\n",(0,a.jsxs)(n.li,{children:["A valid Stripe account with ",(0,a.jsx)(n.em,{children:"Stripe connect"})]}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"You can find some ressource (in french) here :"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"https://codecommun.coop/blog/sysadmin-mon-chaton-part1",children:"https://codecommun.coop/blog/sysadmin-mon-chaton-part1"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"https://codecommun.coop/blog/sysadmin-mon-chaton-part2",children:"https://codecommun.coop/blog/sysadmin-mon-chaton-part2"})}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"If you're ready for adventure, create a new folder \"TiBillet\", and let's start by installing a Fedow!"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"mkdir TiBillet && cd TiBillet\n"})}),"\n",(0,a.jsx)(n.h3,{id:"generate-many-fernet-key-and-django-secret-key",children:"Generate many Fernet key and django secret key"}),"\n",(0,a.jsx)(n.p,{children:"You will need 3 couple of Fernet/Django secret key."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# Generate fernet key with the fedow image :\n# Choose one line and fill the .env file\ndocker run --rm tibillet/fedow poetry run python3 -c \"from cryptography.fernet import Fernet; print('\\n'.join([Fernet.generate_key().decode('utf-8') for i in range(0,30)]))\"\n\n# Generate django secret key with the fedow image :\n# Choose one line and fill the .env file\ndocker run --rm tibillet/fedow poetry run python3 -c \"from django.core.management.utils import get_random_secret_key; print('\\n'.join([get_random_secret_key() for i in range(0,30)]))\"\n"})}),"\n",(0,a.jsx)(n.h2,{id:"fedow--one-ring-to-rule-them-all",children:"Fedow : One ring to rule them all"}),"\n",(0,a.jsx)(n.h3,{id:"environment",children:"Environment"}),"\n",(0,a.jsx)(n.p,{children:"Create the Fedow folder :"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"mkdir -p TiBillet/Fedow && cd TiBillet/Fedow\n"})}),"\n",(0,a.jsx)(n.p,{children:"Create .env file and fill it with your own variable"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"nano .env\n"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# Create .env and fill with :\nSECRET_KEY='' # see upper to create one\nFERNET_KEY='' # see upper to create one\nDOMAIN='' # ex : fedow.domain.com\nSTRIPE_KEY='' # from your stripe account\n"})}),"\n",(0,a.jsx)(n.p,{children:"Create frontend and backend network with docker if needed"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"docker network create frontend\ndocker network create fedow_backend\n"})}),"\n",(0,a.jsx)(n.p,{children:"Prepare the logs, assets and database folder"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"mkdir logs www database\n"})}),"\n",(0,a.jsx)(n.h3,{id:"nginx-rules",children:"Nginx rules"}),"\n",(0,a.jsx)(n.p,{children:"Cr\xe9ate the nginx conf file :"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"nano nginx/django.conf\n"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"server {\n    listen 80;\n    server_name localhost;\n\n    access_log /logs/nginxAccess.log;\n    error_log /logs/nginxError.log;\n\n    location /static {\n        root /www;\n    }\n\n    location /media {\n        root /www;\n    }\n\n    location / {\n        # everything is passed to Gunicorn\n        proxy_pass http://fedow_django:8000;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header Host $host;\n        proxy_redirect off;\n    }\n}\n"})}),"\n",(0,a.jsx)(n.h3,{id:"docker-compose",children:"Docker compose"}),"\n",(0,a.jsx)(n.p,{children:"create the docker compose file :"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"nano docker-compose.yml\n"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:'services:\n  fedow_memcached:\n    image: memcached:1.6\n    container_name: fedow_memcached\n    hostname: fedow_memcached\n    restart: always\n    networks:\n      - fedow_backend\n\n  fedow_django:\n    image: tibillet/fedow:latest\n    container_name: fedow_django\n    hostname: fedow_django\n    restart: always\n    env_file: .env\n    user: fedow\n    links:\n      - fedow_memcached:memcached\n    volumes:\n      - ./database:/home/fedow/Fedow/database\n      - ./www:/home/fedow/Fedow/www\n      - ./logs:/home/fedow/Fedow/logs\n    networks:\n      - fedow_backend\n\n    # only useful for dev purpose :\n    extra_hosts:\n      - "fedow.tibillet.localhost:172.17.0.1"\n      - "lespass.tibillet.localhost:172.17.0.1"\n      - "cashless.tibillet.localhost:172.17.0.1"\n\n\n  fedow_nginx:\n    image: nginx:latest\n    restart: always\n    container_name: fedow_nginx\n    hostname: fedow_nginx\n    volumes:\n      - ./www:/www\n      - ./logs:/logs\n      - ./nginx:/etc/nginx/conf.d\n    depends_on:\n      - fedow_django\n    links:\n      - fedow_django:fedow_django\n    labels:\n      - traefik.enable=true\n      - traefik.docker.network=frontend\n      - traefik.http.routers.fedow_nginx.tls.certresolver=myresolver\n      - traefik.http.routers.fedow_nginx.rule=Host(`$DOMAIN`)\n    networks:\n      - frontend\n      - fedow_backend\n\n\nnetworks:\n  frontend:\n    external: true\n  fedow_backend:\n'})}),"\n",(0,a.jsx)(n.h3,{id:"launch-the-rocket-",children:"Launch the rocket !"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"docker compose up -d \n# To see the logs :\ndocker compose logs -f \n"})}),"\n",(0,a.jsxs)(n.p,{children:["And check to ",(0,a.jsx)(n.code,{children:"https://<FEDOW_DOMAIN>/dashboard"})]}),"\n",(0,a.jsx)(n.p,{children:"Congratulation, You own your own blockchain ;)"}),"\n",(0,a.jsx)(n.h3,{id:"backup",children:"Backup"}),"\n",(0,a.jsx)(n.p,{children:"To make a backup, simply back up the database folder regularly."}),"\n",(0,a.jsx)(n.h2,{id:"lespass--multi-tenant-engine-for-membership-ticketing-and-online-cashless-refill",children:"Lespass : Multi tenant engine for membership, ticketing and online cashless refill."}),"\n",(0,a.jsxs)(n.p,{children:["Lespass is a multi-tenant engine. You can run it with or without a wildcard certificate. See\nthe ",(0,a.jsx)(n.a,{href:"https://codecommun.coop/",children:"Code Commun blog"})," for\nexemple : ",(0,a.jsx)(n.a,{href:"https://codecommun.coop/blog/sysadmin-mon-chaton-part2",children:"https://codecommun.coop/blog/sysadmin-mon-chaton-part2"})]}),"\n",(0,a.jsx)(n.p,{children:"In this tutoriel, we work as a mono tenant instance. Contact us if you want start TiBillet as SaaS multi tenant."}),"\n",(0,a.jsx)(n.h3,{id:"environment-1",children:"Environment"}),"\n",(0,a.jsx)(n.p,{children:"Create the Lespass folder :"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"mkdir TiBillet/Lespass && cd TiBillet/Lespass\n"})}),"\n",(0,a.jsx)(n.p,{children:"Prepare the logs, assets, backup and database folder"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"mkdir logs www backup database nginx\n"})}),"\n",(0,a.jsx)(n.p,{children:"create .env file and fill it with your own variable"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"nano .env\n"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# Secret\nDJANGO_SECRET='' # see upper to create one\nFERNET_KEY='' # see upper to create one\n\nSTRIPE_KEY='' # from your stripe account\n# or \nSTRIPE_KEY_TEST=''\nSTRIPE_TEST=0 # set to 1 for use stripe test env\n\n# Database\nPOSTGRES_USER='lespass_postgres_user'\nPOSTGRES_PASSWORD='' # strong ! generate a new fernet for exemple.\nPOSTGRES_DB='lespass'\n\nADMIN_EMAIL=''\nTIME_ZONE='Europe/Paris' # or where you are\n\nFEDOW_DOMAIN='' # the same as Fedow\n\nDOMAIN='' # for the wildcard : without subdomain ! ex : tibillet.coop, not lespass.tibillet.coop\nPUBLIC='TiBillet Coop.' # The name of the root instance\nSUB='' # the sub domain of your first place ex : if 'festival', it will be accessible on https://festival.tibillet.coop\nMETA='' # the federated agenda for all events on all tenants. If 'agenda', it will be accessible, for exemple, on https://agenda.tibillet.coop\n\n# For transactionnal email : \nEMAIL_HOST=''\nEMAIL_PORT=''\nEMAIL_HOST_USER=''\nEMAIL_HOST_PASSWORD=''\n\n# Change only if needed :\nCELERY_BROKER='redis://redis:6379/0'\nCELERY_BACKEND='redis://redis:6379/0'\n"})}),"\n",(0,a.jsx)(n.h3,{id:"nginx-rules-1",children:"Nginx rules"}),"\n",(0,a.jsx)(n.p,{children:"Create the file :"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"nano nginx/lespass.conf\n"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'server {\n\n    listen 80;\n    server_name localhost;\n\n    access_log /logs/nginxAccess.log;\n    error_log /logs/nginxError.log;\n\n    location /static {\n        root /www;\n    }\n\n    location /media {\n        root /www;\n    }\n\n    location / {\n        # everything is passed to Gunicorn\n        proxy_pass http://lespass_django:8002;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header Host $host;\n        proxy_redirect off;\n        proxy_http_version 1.1;\n        client_max_body_size 4M;\n        proxy_buffer_size 16k;\n        proxy_buffers 32 16k;\n        proxy_set_header Upgrade $http_upgrade;\n        proxy_set_header Connection "upgrade";\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-Host $server_name;\n    }\n}\n\ninclude mime.types;\ntypes {\n    # here are additional types\n    application/javascript mjs;\n}\n'})}),"\n",(0,a.jsx)(n.h3,{id:"docker-compose-1",children:"Docker compose"}),"\n",(0,a.jsx)(n.p,{children:"create the docker compose file :"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"nano docker-compose.yml\n"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:'services:\n  lespass_postgres:\n    image: postgres:13-bookworm\n    restart: always\n    container_name: lespass_postgres\n    hostname: lespass_postgres\n    volumes:\n      - ./database:/var/lib/postgresql/data\n    env_file: .env\n    networks:\n      - lespass_backend\n\n\n  lespass_memcached:\n    image: memcached:1.6\n    container_name: lespass_memcached\n    hostname: lespass_memcached\n    restart: always\n    networks:\n      - lespass_backend\n\n\n  lespass_redis:\n    container_name: lespass_redis\n    hostname: lespass_redis\n    image: redis:7.2.3-bookworm\n    restart: always\n    networks:\n      - lespass_backend\n\n  lespass_django:\n    image: tibillet/lespass:latest\n    restart: always\n    container_name: lespass_django\n    hostname: lespass_django\n    volumes:\n      - ./www:/DjangoFiles/www\n      - ./logs:/DjangoFiles/logs\n      - ./backup:/Backup\n      - ./ssh:/home/tibillet/.ssh # if you want ssh borgbackup \n    env_file: .env\n    depends_on:\n      - lespass_postgres\n      - lespass_redis\n      - lespass_memcached\n    links:\n      - lespass_postgres:postgres\n      - lespass_redis:redis\n      - lespass_memcached:memcached\n    networks:\n      - lespass_backend\n    # only useful for dev purpose :\n    extra_hosts:\n      - "fedow.tibillet.localhost:172.17.0.1"\n      - "lespass.tibillet.localhost:172.17.0.1"\n      - "cashless.tibillet.localhost:172.17.0.1"\n        \n  lespass_celery:\n    image: tibillet/lespass:latest\n    restart: always\n    container_name: lespass_celery\n    hostname: lespass_celery\n    env_file: .env\n    depends_on:\n      - lespass_postgres\n      - lespass_redis\n      - lespass_memcached\n    links:\n      - lespass_postgres:postgres\n      - lespass_redis:redis\n      - lespass_memcached:memcached\n    command: "poetry run celery -A TiBillet worker -l INFO"\n    networks:\n      - lespass_backend\n\n\n  lespass_nginx:\n    image: nginx:latest\n    container_name: lespass_nginx\n    hostname: lespass_nginx\n    restart: always\n    links:\n      - lespass_django:lespass_django\n    volumes:\n      - ./www:/www\n      - ./logs:/logs\n      - ./nginx:/etc/nginx/conf.d\n    labels:\n      - traefik.enable=true\n      - traefik.docker.network=frontend\n      - traefik.http.routers.lespass.tls.certresolver=myresolver\n      - traefik.http.routers.lespass.rule=Host(`$DOMAIN`) || Host(`www.$DOMAIN`) || Host(`$META.$DOMAIN`) || Host(`$SUB.$DOMAIN`)\n    networks:\n      - frontend\n      - lespass_backend\n\nnetworks:\n  frontend:\n    external: true\n  lespass_backend:\n'})}),"\n",(0,a.jsx)(n.h3,{id:"launch-the-rocket--1",children:"Launch the rocket !"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"docker compose up -d \n# To see the logs :\ndocker compose logs -f \n"})}),"\n",(0,a.jsxs)(n.p,{children:["And check to ",(0,a.jsx)(n.code,{children:"https://<SUB>.<DOMAIN>"})]}),"\n",(0,a.jsx)(n.p,{children:"Congratulation !"}),"\n",(0,a.jsx)(n.h3,{id:"update",children:"Update"}),"\n",(0,a.jsx)(n.p,{children:"Just update the container :"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"docker compose pull\ndocker compose up -d\n"})}),"\n",(0,a.jsx)(n.h3,{id:"backups",children:"Backups"}),"\n",(0,a.jsx)(n.p,{children:"TODO : Create a blog note for borgbackup, cron and postgres dump."}),"\n",(0,a.jsx)(n.h2,{id:"laboutik--cash-and-cashless-registrer-nfc-card-reader-for-cashless-membership-or-badge-scan",children:"LaBoutik : Cash and cashless registrer. NFC card reader for cashless, membership or badge scan."}),"\n",(0,a.jsx)(n.h3,{id:"environment-2",children:"Environment"}),"\n",(0,a.jsx)(n.p,{children:"Create the Lespass folder :"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"mkdir Laboutik && cd Laboutik\n"})}),"\n",(0,a.jsx)(n.p,{children:"Prepare the logs, assets, backup and database folder"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"mkdir logs www backup database nginx ssh\n"})}),"\n",(0,a.jsx)(n.p,{children:"create .env file and fill it with your own variable"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"nano .env\n"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"DJANGO_SECRET=''\nFERNET_KEY=''\n\nPOSTGRES_USER='laboutik_user'\nPOSTGRES_DB='laboutik'\nPOSTGRES_PASSWORD=''\n\n# The domain of this instance ex : 'cashless.tibillet.localhost'\nDOMAIN=''\n\n# admin email\nADMIN_EMAIL=''\n\n# For transactionnal email :\nEMAIL_HOST=\"\"\nEMAIL_PORT=\"\"\nEMAIL_HOST_USER=\"\"\nEMAIL_HOST_PASSWORD=\"\"\n\nTIME_ZONE='Europe/Paris'\nLANGUAGE_CODE='fr'\n\n########## FOR CASHLESS ##########\n\n# No Cashless if no Fedow nor Lespass tenant manager\nFEDOW_URL='' # ex : https://fedow.tibillet.localhost/\nLESPASS_TENANT_URL='' # ex : https://festival.tibillet.localhost/\n\n# The name of your cashless asset ex : TestCoin, FestivalCoin, etc ....\nMAIN_ASSET_NAME='' \n\n########## FOR SAVE CRON TASK ##########dex\n\n# can be empty if you don't backup\nBORG_REPO=''\nBORG_PASSPHRASE=''\n"})}),"\n",(0,a.jsx)(n.h3,{id:"nginx-rules-2",children:"Nginx rules"}),"\n",(0,a.jsx)(n.p,{children:"Create the file :"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"nano nginx/laboutik.conf\n"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"server {\n\n    listen 80;\n    server_name localhost;\n\n    access_log /DjangoFiles/logs/nginxAccess.log;\n    error_log /DjangoFiles/logs/nginxError.log;\n\n    # Static and media g\xe9r\xe9 par Nginx :\n     location /static {\n         root /DjangoFiles/www;\n     }\n\n     location /media {\n         root /DjangoFiles/www;\n     }\n\n    location / {\n        # everything is passed to Gunicorn/Django\n        proxy_pass http://laboutik_django:8000;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header Host $host;\n        proxy_redirect off;\n    }\n}\n"})}),"\n",(0,a.jsx)(n.h3,{id:"docker-compose-2",children:"Docker compose"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:'services:\n  laboutik_postgres:\n    image: postgres:11.5-alpine\n    restart: always\n    env_file: .env\n    container_name: laboutik_postgres\n    hostname: laboutik_postgres\n    volumes:\n      - ./database/data:/var/lib/postgresql/data\n    networks:\n      - laboutik_backend\n\n  laboutik_memcached:\n    image: memcached:1.6\n    container_name: laboutik_memcached\n    hostname: laboutik_memcached\n    restart: always\n    networks:\n      - laboutik_backend\n\n  laboutik_redis:\n    image: redis:6-alpine\n    restart: always\n    env_file: .env\n    container_name: laboutik_redis\n    hostname: laboutik_redis\n    networks:\n      - laboutik_backend\n\n  laboutik_django:\n    image: tibillet/laboutik:latest\n    restart: always\n    env_file: .env\n    container_name: laboutik_django\n    hostname: laboutik_django\n    volumes:\n      - ./www:/DjangoFiles/www\n      - ./logs:/DjangoFiles/logs\n      - ./backup:/Backup\n      - ./ssh:/home/tibillet/.ssh # if you want to use borgbackup with ssh\n    links:\n      - laboutik_postgres:postgres\n      - laboutik_redis:redis\n      - laboutik_memcached:memcached\n    depends_on:\n      - laboutik_postgres\n      - laboutik_redis\n      - laboutik_memcached\n    networks:\n      - laboutik_backend\n    # only useful for dev purpose :\n    extra_hosts:\n      - "fedow.tibillet.localhost:172.17.0.1"\n      - "lespass.tibillet.localhost:172.17.0.1"\n      - "cashless.tibillet.localhost:172.17.0.1"\n\n\n  laboutik_celery:\n    image: tibillet/laboutik:latest\n    restart: always\n    env_file: .env\n    container_name: laboutik_celery\n    hostname: laboutik_celery\n    volumes:\n      - ./www:/DjangoFiles/www\n      - ./logs:/DjangoFiles/logs\n      - ./backup:/Backup\n    links:\n      - laboutik_postgres:postgres\n      - laboutik_redis:redis\n      - laboutik_memcached:memcached\n    depends_on:\n      - laboutik_postgres\n      - laboutik_redis\n      - laboutik_memcached\n    networks:\n      - laboutik_backend\n    command: "bash start_celery.sh"\n\n  laboutik_nginx:\n    image: nginx\n    restart: always\n    container_name: laboutik_nginx\n    hostname: laboutik_nginx\n    depends_on:\n      - laboutik_django\n    links:\n      - laboutik_django:laboutik_django\n    volumes:\n      - ./www:/DjangoFiles/www\n      - ./logs:/DjangoFiles/logs\n      - ./nginx:/etc/nginx/conf.d\n    labels:\n      - traefik.enable=true\n      - traefik.docker.network=frontend\n      - traefik.http.routers.laboutik_nginx.tls.certresolver=myresolver\n      - traefik.http.routers.laboutik_nginx.rule=Host(`${DOMAIN}`)\n    networks:\n      - frontend\n      - laboutik_backend\n\nnetworks:\n  frontend:\n    external: true\n  laboutik_backend:\n'})}),"\n",(0,a.jsx)(n.h3,{id:"launch-the-rocket--2",children:"Launch the rocket !"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"docker compose up -d \n# To see the logs :\ndocker compose logs -f \n"})}),"\n",(0,a.jsx)(n.p,{children:"You should have received an e-mail inviting you to create your administrator password."}),"\n",(0,a.jsx)(n.p,{children:"Congratulations! You can now read\nthrough the documentation and come and see us on discord to tell us you've succeeded!"}),"\n",(0,a.jsx)(n.h3,{id:"update-1",children:"Update"}),"\n",(0,a.jsx)(n.p,{children:"Just pull the latest docker image release :"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"docker compose pull\ndocker compose up -d \n"})}),"\n",(0,a.jsx)(n.h3,{id:"backups-1",children:"Backups"}),"\n",(0,a.jsx)(n.p,{children:"TODO: A note blog for Syncthing, Borgbackup, Crontab and postgres dump."})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}},1621:(e,n,s)=>{s.d(n,{R:()=>t,x:()=>l});var a=s(6663);const o={},r=a.createContext(o);function t(e){const n=a.useContext(r);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:t(e.components),a.createElement(r.Provider,{value:n},e.children)}}}]);